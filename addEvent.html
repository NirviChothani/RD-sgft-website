<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Add SGFT Event</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

  <style>
    body { background-color: #fff4ea; }
    .sidebar { height: 100vh; width: 40vh; background-color: #fff; border-right: 1px solid #dee2e6; padding: 18px; box-shadow: 2px 0 5px rgba(0, 0, 0, 0.1); }
    .btn-logout { background-color: #9c27b0; color: white; width: 100%; margin-top: 20px; border: none; padding: 10px; border-radius: 5px; font-weight: bold; cursor: pointer; }
    .btn-logout:hover { background-color: #e66a1f; }
    .events-table th { background-color: #ff7b29; color: white; }
    .highlight-orange { color: #ff7b29; }
    .highlight-purple { color: #9c27b0; }
    .icon-btn { background: none; border: none; color: #9c27b0; cursor: pointer; transition: transform 0.2s; }
    .icon-btn:hover { transform: scale(1.1); }
    .icon-btn.delete { color: #ff7b29; }
    .icon-btn.delete:hover { color: #e66a1f; }
    .sidebar a { text-decoration: none; color: #333; font-size: 1.1em; margin-bottom: 15px; padding: 10px; border-radius: 5px; width: 100%; transition: background-color 0.3s ease; }
    .sidebar a:hover { background-color: #ff7b29; color: white; }
    .sidebar img { border-radius: 50%; width: 80px; height: 80px; object-fit: cover; }
    .sidebar h5 { color: #ff7b29; font-weight: bold; margin-top: 10px; }
    .sidebar p { color: #9c27b0; font-size: 0.9em; }
    .text-primary { color: #9c27b0; font-weight: bold; }
    .form-container { background: white; max-width: 600px; margin: auto; padding: 30px; border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
    .btn-primary { background-color: #ff7b29; border: none; padding: 10px 20px; border-radius: 5px; color: white; font-size: 16px; cursor: pointer; transition: background-color 0.3s, transform 0.2s; }
    .btn-primary:hover { background-color: #7b1fa2; transform: scale(1.05); }
    .toast { position: fixed; bottom: 20px; right: 20px; background: #28a745; color: white; padding: 15px 20px; border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.2); opacity: 0; pointer-events: none; transition: opacity 0.5s ease; z-index: 1000; }
    .toast.show { opacity: 1; pointer-events: auto; }
  </style>
</head>
<body>
<div class="d-flex">
  <div id="sidebar-placeholder"></div>

  <div class="container-fluid p-4">
    <div class="form-container">
      <h2 class="text-center mb-4">Add SGFT Event</h2>
      <form id="eventForm">
        <div class="mb-3">
          <label class="form-label">Title</label>
          <input type="text" class="form-control" id="title" required>
        </div>
        <div class="mb-3">
          <label class="form-label">Date</label>
          <input type="date" class="form-control" id="date" required>
        </div>
        <div class="mb-3">
          <label class="form-label">Summary</label>
          <textarea class="form-control" id="summary" required></textarea>
        </div>
        <div class="mb-3">
          <label class="form-label">People Benefitted</label>
          <input type="number" class="form-control" id="peopleBenefitted" required>
        </div>
        <div class="mb-3">
          <label class="form-label">Amount Utilised (â‚¹)</label>
          <input type="number" class="form-control" id="amountUtilised" required>
        </div>
        <div class="mb-3">
          <label class="form-label">Upload Image</label>
          <input type="file" class="form-control" id="imageFile" accept="image/*" required>
        </div>
        <button type="submit" class="btn btn-primary w-100">Add Event</button>
      </form>
    </div>
  </div>
</div>

<div class="toast" id="successToast">Event added successfully!</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.0/firebase-app.js";
  import { getDatabase, ref, push } from "https://www.gstatic.com/firebasejs/11.6.0/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyDkLmo4Vf-1U8Vl_grn2waMigYCyMj1BaU",
    authDomain: "formtestsgft.firebaseapp.com",
    databaseURL: "https://formtestsgft-default-rtdb.firebaseio.com",
    projectId: "formtestsgft",
    storageBucket: "formtestsgft.appspot.com",
    messagingSenderId: "688396867961",
    appId: "1:688396867961:web:8cc2136b755be21f4f77a8"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);
  const eventForm = document.getElementById('eventForm');
  const successToast = document.getElementById('successToast');

  eventForm.addEventListener('submit', async (e) => {
    e.preventDefault();

    const imageFile = document.getElementById('imageFile').files[0];

    if (!imageFile) {
      alert("Please upload an image.");
      return;
    }

    const cloudinaryData = new FormData();
    cloudinaryData.append('file', imageFile);
    cloudinaryData.append('upload_preset', 'SGFTEvents');

    const cloudinaryRes = await fetch('https://api.cloudinary.com/v1_1/SGFTEventImg/image/upload', {
      method: 'POST',
      body: cloudinaryData
    });

    const cloudinaryResult = await cloudinaryRes.json();
    const imageUrl = cloudinaryResult.secure_url;

    const newEvent = {
      title: document.getElementById('title').value,
      date: document.getElementById('date').value,
      summary: document.getElementById('summary').value,
      peopleBenefitted: document.getElementById('peopleBenefitted').value,
      amountUtilised: document.getElementById('amountUtilised').value,
      imageUrl: imageUrl
    };

    const eventsRef = ref(db, 'events');
    push(eventsRef, newEvent).then(() => {
      successToast.classList.add('show');
      setTimeout(() => successToast.classList.remove('show'), 3000);
      eventForm.reset();
    }).catch(err => alert("Error saving event: " + err));
  });

  // Load sidebar content
  fetch('sidebar.html')
    .then(response => response.text())
    .then(html => document.getElementById('sidebar-placeholder').innerHTML = html);
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
