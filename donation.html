<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Donate - Sindhu Global Development Foundation</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      color: #333;
      line-height: 1.6;
      background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
      margin: 0;
      padding: 0;
    }
    .container {
      max-width: 900px;
      margin: 40px auto;
      background: #fff;
      border-radius: 16px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
      overflow: hidden;
    }
    .header {
      background: linear-gradient(135deg, #ff7b29 0%, #9c27b0 100%);
      color: #fff;
      padding: 20px;
      text-align: center;
      border-radius: 16px 16px 0 0;
    }
    .header img {
      width: 60px;
      height: 60px;
      margin-bottom: 10px;
    }
    .header h1 {
      font-size: 1.5rem;
      font-weight: 700;
      margin: 0;
    }
    .content {
      padding: 30px;
      display: flex;
      gap: 30px;
    }
    .donate-info {
      flex: 1;
    }
    .donate-info h2 {
      color: #ff7b29;
      font-size: 1.8rem;
      font-weight: 700;
      margin-bottom: 20px;
    }
    .donate-info p {
      color: #555;
      margin-bottom: 15px;
    }
    .donation-type {
      margin-bottom: 20px;
    }
    .form-group {
      margin-bottom: 15px;
    }
    .form-label {
      color: #444;
      font-weight: 600;
      font-size: 0.95rem;
      margin-bottom: 8px;
      display: block;
    }
    .form-control, .form-select {
      width: 100%;
      padding: 12px 15px;
      border: 1px solid #ddd;
      border-radius: 8px;
      font-size: 0.95rem;
      transition: all 0.2s ease;
    }
    .form-control:focus, .form-select:focus {
      border-color: #ff7b29;
      box-shadow: 0 0 0 3px rgba(255, 123, 41, 0.1);
      outline: none;
    }
    .form-control.is-invalid {
      border-color: #dc3545;
    }
    .invalid-feedback {
      color: #dc3545;
      font-size: 0.85rem;
      margin-top: 5px;
      display: none;
    }
    .form-control.is-invalid ~ .invalid-feedback,
    .form-select.is-invalid ~ .invalid-feedback {
      display: block;
    }
    .form-select {
      appearance: none;
      background: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' fill='%23333' viewBox='0 0 16 16'%3E%3Cpath d='M7.247 11.14 2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z'/%3E%3C/svg%3E") no-repeat right 12px center;
    }
    .donation-details {
      flex: 1;
      background: #fff;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.05);
    }
    .donation-details h3 {
      color: #333;
      font-size: 1.4rem;
      font-weight: 600;
      margin-bottom: 20px;
    }
    .btn-pay, .btn-submit {
      width: 100%;
      padding: 15px;
      color: #fff;
      border: none;
      border-radius: 8px;
      font-size: 1.1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    .btn-pay {
      background: #007bff;
    }
    .btn-pay:hover {
      background: #0056b3;
      transform: translateY(-2px);
    }
    .btn-submit {
      background: #28a745;
    }
    .btn-submit:hover {
      background: #218838;
      transform: translateY(-2px);
    }
    .payment-options {
      display: flex;
      justify-content: space-between;
      margin-top: 10px;
    }
    .payment-options img {
      height: 20px;
    }
    .terms {
      color: #6c757d;
      font-size: 0.85rem;
      margin-top: 15px;
      text-align: center;
    }
    .queries-section {
      text-align: center;
      padding: 15px;
      background: #f8f9fa;
      border: 1px solid #ddd;
      border-radius: 8px;
      margin-bottom: 20px;
    }
    .queries-section h4 {
      color: #ff7b29;
      font-size: 1.2rem;
      margin-bottom: 10px;
    }
    .queries-section p {
      font-size: 0.9rem;
      color: #555;
      margin-bottom: 8px;
    }
    .queries-section a {
      color: #ff7b29;
      text-decoration: none;
    }
    .queries-section a:hover {
      text-decoration: underline;
    }
    .modal-content {
      border-radius: 12px;
      text-align: center;
      padding: 30px;
    }
    .modal-header {
      border-bottom: none;
      padding: 0;
    }
    .modal-title {
      font-size: 1.5rem;
      color: #28a745;
      font-weight: 700;
    }
    .modal-body p {
      font-size: 1rem;
      color: #333;
      margin-bottom: 20px;
    }
    #otherItemContainer {
      display: none;
      margin-top: 10px;
    }
    @media (max-width: 768px) {
      .content {
        flex-direction: column;
        padding: 20px;
      }
      .donation-details {
        padding: 15px;
      }
      .queries-section {
        padding: 10px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <img src="images/sgdf-logo.png" alt="Logo">
      <h1>Sindhu Global Development Foundation</h1>
    </div>
    <div class="content">
      <div class="donate-info">
        <h2>Make a Difference</h2>
        <p>Support our mission to empower underprivileged!</p>
        <div class="queries-section">
          <h4>In Case of Queries</h4>
          <!-- <p>Sindhu Global Development Foundation</p> -->
          <!-- <p>Block C-5/Room No 10, Dev Samaj Road, Netaji, Ulhasnagar 421004, Maharashtra, India</p> -->
          <p>Phone: <a href="tel:+917021668519">+91 7021668519 (Haresh Rupani)</a></p>
          <p>Phone: <a href="tel:+919371262700">+91 9371262700 (CA Hari Dudani)</a></p>
          <p>Email: <a href="mailto:sindhuglobal.df@gmail.com">sindhuglobal.df@gmail.com</a></p>
          <!-- <p>CIN: U80301MH2015NPL262428 | PAN: AAVCS5664E</p> -->
          <!-- <p>80G Reg.: AAVCS5664EF20201 | CSR Reg.: CSR00005292</p> -->
        </div>
        <div class="donation-type">
          <div class="form-group">
            <label for="donationType" class="form-label">Select Type of Donation *</label>
            <select class="form-select" id="donationType" onchange="updateSubOptions()" required>
              <option value="">-Select-</option>
              <option value="money">Money</option>
              <option value="inKind">In-Kind</option>
            </select>
            <div class="invalid-feedback">Please select a donation type.</div>
          </div>
          <div class="form-group" id="subOptionContainer" style="display: none;">
            <label for="subOption" class="form-label">Select Sub-Option *</label>
            <select class="form-select" id="subOption" onchange="toggleOtherItem()" required>
              <option value="">-Select-</option>
            </select>
            <div class="invalid-feedback">Please select a sub-option.</div>
          </div>
          <div class="form-group" id="otherItemContainer">
            <label for="otherItem" class="form-label">Other Item (Optional)</label>
            <input type="text" class="form-control" id="otherItem" placeholder="Enter custom item if 'Other' is selected">
            <div class="invalid-feedback">Custom item must be at least 3 characters long.</div>
          </div>
        </div>
        <div class="terms">
          Terms & Conditions: You agree to share information entered on this page with Sindhu Global Development Foundation (owner of this page) and Razorpay, adhering to applicable laws.
        </div>
      </div>
      <div class="donation-details" id="donationDetails">
        <h3>Donation Details</h3>
        <div id="standardFields">
          <div class="form-group">
            <label for="fullName" class="form-label">Full Name *</label>
            <input type="text" class="form-control" id="fullName" required>
            <div class="invalid-feedback">Full name must be at least 2 characters long and contain only letters and spaces.</div>
          </div>
          <div class="form-group">
            <label for="email" class="form-label">Email *</label>
            <input type="email" class="form-control" id="email" required>
            <div class="invalid-feedback">Please enter a valid email address.</div>
          </div>
          <div class="form-group">
            <label for="address" class="form-label">Address *</label>
            <input type="text" class="form-control" id="address" required>
            <div class="invalid-feedback">Address must be at least 5 characters long.</div>
          </div>
          <div class="form-group">
            <label for="panNo" class="form-label">PAN No. *</label>
            <input type="text" class="form-control" id="panNo" required>
            <div class="invalid-feedback">Please enter a valid PAN number (e.g., ABCDE1234F).</div>
          </div>
        </div>
        <div id="dynamicFields"></div>
        <div id="donationTypeDisplay" class="form-group" style="display: none;">
          <label class="form-label">Donation Type:</label>
          <p id="selectedType" style="margin: 0;"></p>
        </div>
        <button type="button" class="btn-pay" id="payButton" style="display: none;" onclick="handleOnlinePayment()">Pay Amount <span id="displayAmount">0.00</span></button>
        <button type="button" class="btn-submit" id="submitButton" style="display: none;" onclick="handleSubmission()">Submit</button>
        <div class="payment-options" style="display: none;" id="paymentOptions">
          <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/1/1b/UPI-Logo.svg/1200px-UPI-Logo.svg.png" alt="UPI">
          <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/5/5e/Visa_Inc._logo.svg/200px-Visa_Inc._logo.svg.png" alt="Visa">
          <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/1/1a/MasterCard_2019_logo.svg/1200px-MasterCard_2019_logo.svg.png" alt="MasterCard">
          <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/b/b8/RuPay_Logo.svg/1200px-RuPay_Logo.svg.png" alt="RuPay">
        </div>
      </div>
    </div>
  </div>

  <!-- Thank You Modal -->
  <div class="modal fade" id="thankYouModal" tabindex="-1" aria-labelledby="thankYouModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="thankYouModalLabel">Thank You!</h5>
        </div>
        <div class="modal-body">
          <p>Thank you for your generous donation. Your support makes a difference!</p>
          <p>Login credentials for accessing Donor Dashboard have been sent via email.</p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Firebase SDK (Compatibility Mode) -->
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // Declare variables at the top to avoid TDZ
    let selectedType = '';
    let selectedSubOption = '';
    let isOnlineProcessed = false;

    // Firebase Configuration
    const firebaseConfig = {
      apiKey: "AIzaSyDkLmo4Vf-1U8Vl_grn2waMigYCyMj1BaU",
      authDomain: "formtestsgft.firebaseapp.com",
      databaseURL: "https://formtestsgft-default-rtdb.firebaseio.com",
      projectId: "formtestsgft",
      storageBucket: "formtestsgft.appspot.com",
      messagingSenderId: "688396867961",
      appId: "1:688396867961:web:099be0b0c1a3f81e4f77a8"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    function validateField(field, validationFn, errorMessage) {
      const isValid = validationFn(field.value.trim());
      field.classList.toggle('is-invalid', !isValid);
      const feedback = field.nextElementSibling;
      if (feedback && feedback.classList.contains('invalid-feedback')) {
        feedback.textContent = isValid ? '' : errorMessage;
      }
      return isValid;
    }

    function validateForm() {
      let isValid = true;
      const fullName = document.getElementById('fullName');
      const email = document.getElementById('email');
      const address = document.getElementById('address');
      const panNo = document.getElementById('panNo');
      const donationType = document.getElementById('donationType');
      const subOption = document.getElementById('subOption');
      const otherItem = document.getElementById('otherItem');
      const donationAmount = document.getElementById('donationAmount');
      const itemDetails = document.getElementById('itemDetails');
      const submissionType = document.getElementById('submissionType');
      const submissionDate = document.getElementById('submissionDate');

      // Standard fields
      isValid &= validateField(fullName, value => /^[a-zA-Z\s]{2,}$/.test(value), 'Full name must be at least 2 characters long and contain only letters and spaces.');
      isValid &= validateField(email, value => /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(value), 'Please enter a valid email address.');
      isValid &= validateField(address, value => value.length >= 5, 'Address must be at least 5 characters long.');
      isValid &= validateField(panNo, value => /^[A-Z]{5}[0-9]{4}[A-Z]$/.test(value), 'Please enter a valid PAN number (e.g., ABCDE1234F).');

      // Donation type
      isValid &= validateField(donationType, value => value !== '', 'Please select a donation type.');

      // Sub-option
      if (subOptionContainer.style.display !== 'none') {
        isValid &= validateField(subOption, value => value !== '', 'Please select a sub-option.');
      }

      // Other item (optional, but validated if provided)
      if (otherItem && otherItemContainer.style.display !== 'none' && otherItem.value.trim()) {
        isValid &= validateField(otherItem, value => value.length >= 3, 'Custom item must be at least 3 characters long.');
      }

      // Dynamic fields
      if (selectedType === 'money' && donationAmount) {
        isValid &= validateField(donationAmount, value => value >= 100 && !isNaN(value), 'Donation amount must be at least ₹100.');
        if (selectedSubOption !== 'online') {
          if (submissionType) {
            isValid &= validateField(submissionType, value => value !== '', 'Please select a submission type.');
          }
          if (submissionDate && submissionDateContainer.style.display !== 'none') {
            const today = new Date().setHours(0, 0, 0, 0);
            const selectedDate = new Date(submissionDate.value).setHours(0, 0, 0, 0);
            isValid &= validateField(submissionDate, value => value && selectedDate >= today, 'Please select a future date.');
          }
        }
      } else if (selectedType === 'inKind' && itemDetails) {
        isValid &= validateField(itemDetails, value => value.length >= 5, 'Item details must be at least 5 characters long.');
        if (submissionType) {
          isValid &= validateField(submissionType, value => value !== '', 'Please select a submission type.');
        }
        if (submissionDate && submissionDateContainer.style.display !== 'none') {
          const today = new Date().setHours(0, 0, 0, 0);
          const selectedDate = new Date(submissionDate.value).setHours(0, 0, 0, 0);
          isValid &= validateField(submissionDate, value => value && selectedDate >= today, 'Please select a future date.');
        }
      }

      return isValid;
    }

    function updateSubOptions() {
      const donationType = document.getElementById('donationType').value;
      const subOptionSelect = document.getElementById('subOption');
      const subOptionContainer = document.getElementById('subOptionContainer');
      const donationTypeDisplay = document.getElementById('donationTypeDisplay');
      const selectedTypeElement = document.getElementById('selectedType');

      subOptionSelect.innerHTML = '<option value="">-Select-</option>';
      donationTypeDisplay.style.display = 'none';
      document.getElementById('dynamicFields').innerHTML = '';
      document.getElementById('payButton').style.display = 'none';
      document.getElementById('submitButton').style.display = 'none';
      document.getElementById('paymentOptions').style.display = 'none';
      isOnlineProcessed = false;
      document.getElementById('otherItemContainer').style.display = 'none';

      if (donationType) {
        subOptionContainer.style.display = 'block';
        selectedType = donationType;
        selectedTypeElement.textContent = donationType.charAt(0).toUpperCase() + donationType.slice(1).replace(/([A-Z])/g, ' $1');
        donationTypeDisplay.style.display = 'block';
        if (donationType === 'money') {
          const options = ['cash', 'cheque', 'online'];
          options.forEach(option => {
            const optionText = option.charAt(0).toUpperCase() + option.slice(1).replace(/([A-Z])/g, ' $1');
            subOptionSelect.innerHTML += `<option value="${option}">${optionText}</option>`;
          });
        } else if (donationType === 'inKind') {
          db.ref('inkindItems').once('value', (snapshot) => {
            subOptionSelect.innerHTML = '<option value="">-Select-</option>';
            snapshot.forEach(childSnapshot => {
              const item = childSnapshot.val();
              const optionText = item.charAt(0).toUpperCase() + item.slice(1).replace(/([A-Z])/g, ' $1');
              subOptionSelect.innerHTML += `<option value="${item}">${optionText}</option>`;
            });
            subOptionSelect.innerHTML += '<option value="other">Other</option>';
          }).catch(error => console.error('Error fetching in-kind items:', error));
        }
      } else {
        subOptionContainer.style.display = 'none';
        selectedTypeElement.textContent = '-';
      }
    }

    function toggleOtherItem() {
      const subOption = document.getElementById('subOption').value;
      const otherItemContainer = document.getElementById('otherItemContainer');
      if (subOption === 'other') {
        otherItemContainer.style.display = 'block';
      } else {
        otherItemContainer.style.display = 'none';
        document.getElementById('otherItem').value = '';
      }
      updateDetails();
    }

    function updateDetails() {
      const subOption = document.getElementById('subOption').value;
      const dynamicFields = document.getElementById('dynamicFields');
      const payButton = document.getElementById('payButton');
      const submitButton = document.getElementById('submitButton');
      const paymentOptions = document.getElementById('paymentOptions');

      dynamicFields.innerHTML = '';
      payButton.style.display = 'none';
      submitButton.style.display = 'none';
      paymentOptions.style.display = 'none';
      isOnlineProcessed = false;

      if (subOption) {
        selectedSubOption = subOption;
        if (selectedType === 'money') {
          dynamicFields.innerHTML = `
            <div class="form-group">
              <label for="donationAmount" class="form-label">Donation Amount (₹) *</label>
              <input type="number" class="form-control" id="donationAmount" min="100" required>
              <div class="invalid-feedback">Donation amount must be at least ₹100.</div>
            </div>
          `;
          if (subOption === 'online') {
            payButton.style.display = 'block';
            paymentOptions.style.display = 'flex';
            updatePayButtonText();
            document.getElementById('donationAmount').addEventListener('input', updatePayButtonText);
          } else {
            dynamicFields.innerHTML += `
              <div class="form-group">
                <label for="submissionType" class="form-label">Submission Type *</label>
                <select class="form-select" id="submissionType" onchange="toggleSubmissionDate()" required>
                  <option value="">-Select-</option>
                  <option value="ngo">Submit to NGO</option>
                  <option value="collect">Needs to be Collected</option>
                </select>
                <div class="invalid-feedback">Please select a submission type.</div>
              </div>
              <div class="form-group" id="submissionDateContainer" style="display: none;">
                <label for="submissionDate" class="form-label">Submission/Collection Date *</label>
                <input type="date" class="form-control" id="submissionDate" required>
                <div class="invalid-feedback">Please select a future date.</div>
              </div>
            `;
            submitButton.style.display = 'block';
          }
        } else if (selectedType === 'inKind') {
          dynamicFields.innerHTML = `
            <div class="form-group">
              <label for="itemDetails" class="form-label">Item Details *</label>
              <input type="text" class="form-control" id="itemDetails" placeholder="Describe the items" required>
              <div class="invalid-feedback">Item details must be at least 5 characters long.</div>
            </div>
            <div class="form-group">
              <label for="submissionType" class="form-label">Submission Type *</label>
              <select class="form-select" id="submissionType" onchange="toggleSubmissionDate()" required>
                <option value="">-Select-</option>
                <option value="ngo">Submit to NGO</option>
                <option value="collect">Needs to be Collected</option>
              </select>
              <div class="invalid-feedback">Please select a submission type.</div>
            </div>
            <div class="form-group" id="submissionDateContainer" style="display: none;">
              <label for="submissionDate" class="form-label">Submission/Collection Date *</label>
              <input type="date" class="form-control" id="submissionDate" required>
              <div class="invalid-feedback">Please select a future date.</div>
            </div>
          `;
          submitButton.style.display = 'block';
        }
      }
    }

    function toggleSubmissionDate() {
      const submissionType = document.getElementById('submissionType')?.value;
      const submissionDateContainer = document.getElementById('submissionDateContainer');
      if (submissionType === 'ngo' || submissionType === 'collect') {
        submissionDateContainer.style.display = 'block';
      } else {
        submissionDateContainer.style.display = 'none';
        document.getElementById('submissionDate').value = '';
      }
    }

    function updatePayButtonText() {
      const amount = document.getElementById('donationAmount').value || 0;
      const payButton = document.getElementById('payButton');
      payButton.textContent = `Pay ₹${amount}.00`;
    }

    function handleOnlinePayment() {
      if (!validateForm()) {
        alert('Please correct the errors in the form.');
        return;
      }
      const amount = document.getElementById('donationAmount')?.value.trim();
      if (!amount || amount < 100) {
        alert('Please enter a valid donation amount of at least ₹100.');
        return;
      }
      alert('Payment processing via gateway');
      isOnlineProcessed = true;
      document.getElementById('payButton').style.display = 'none';
      document.getElementById('submitButton').style.display = 'block';
    }

    function handleSubmission() {
      if (!validateForm()) {
        alert('Please correct the errors in the form.');
        return;
      }

      const fullName = document.getElementById('fullName').value.trim();
      const email = document.getElementById('email').value.trim();
      const address = document.getElementById('address').value.trim();
      const panNo = document.getElementById('panNo').value.trim();
      let amountOrItem = '';
      let submissionType = '';
      let submissionDate = '';
      let otherItem = document.getElementById('otherItem')?.value.trim();

      if (selectedType === 'money') {
        amountOrItem = document.getElementById('donationAmount').value.trim();
        if (!amountOrItem || amountOrItem < 100) {
          alert('Please enter a valid donation amount of at least ₹100.');
          return;
        }
        if (selectedSubOption !== 'online' || isOnlineProcessed) {
          submissionType = document.getElementById('submissionType')?.value;
          if (!submissionType && selectedSubOption !== 'online') {
            alert('Please select a submission type.');
            return;
          }
          if (submissionType && (submissionType === 'ngo' || submissionType === 'collect')) {
            submissionDate = document.getElementById('submissionDate')?.value;
            if (!submissionDate) {
              alert('Please select a submission/collection date.');
              return;
            }
          }
          alert(`Thank you ${fullName}! Your ${selectedSubOption} donation of ₹${amountOrItem} shall be ${submissionType === 'ngo' ? 'submitted by you to NGO' : 'collected'} on ${submissionDate || 'a communicated date and time'}.`);
        }
      } else if (selectedType === 'inKind') {
        amountOrItem = document.getElementById('itemDetails')?.value.trim();
        submissionType = document.getElementById('submissionType')?.value;
        if (!amountOrItem || !submissionType) {
          alert('Please fill in all required fields for in-kind donation.');
          return;
        }
        if (submissionType === 'ngo' || submissionType === 'collect') {
          submissionDate = document.getElementById('submissionDate')?.value;
          if (!submissionDate) {
            alert('Please select a submission/collection date.');
            return;
          }
        }
        if (selectedSubOption === 'other' && otherItem && otherItem.length < 3) {
          alert('Custom item must be at least 3 characters long if provided.');
          return;
        }
        amountOrItem = otherItem ? `${amountOrItem} (${otherItem})` : amountOrItem;
        alert(`Thank you ${fullName}! Your in-kind donation of ${amountOrItem} will be ${submissionType === 'ngo' ? 'submitted to NGO' : 'collected'} on ${submissionDate}.`);
      }

      // Save to Firebase Realtime Database
      try {
        const sanitizedEmail = email.replace(/\./g, '_');
        const donationRef = db.ref(`donations/${sanitizedEmail}`).push();
        donationRef.set({
          fullName,
          email,
          address,
          panNo,
          donationType: selectedType,
          subOption: selectedSubOption,
          amountOrItem,
          submissionType: submissionType || 'online',
          submissionDate: submissionDate ? new Date(submissionDate).getTime() : null,
          timestamp: firebase.database.ServerValue.TIMESTAMP
        }).then(() => {
          if (selectedType === 'inKind' && selectedSubOption === 'other' && otherItem) {
            db.ref('otherItems').push({
              item: otherItem,
              donationId: donationRef.key,
              pendingApproval: true,
              timestamp: firebase.database.ServerValue.TIMESTAMP
            });
          }
          const modal = new bootstrap.Modal(document.getElementById('thankYouModal'));
          modal.show();

          document.getElementById('thankYouModal').addEventListener('hidden.bs.modal', function handler() {
            alert('Donation recorded');
            this.removeEventListener('hidden.bs.modal', handler);
          });

          document.querySelectorAll('.form-control, .form-select').forEach(input => {
            input.value = '';
            input.classList.remove('is-invalid');
          });
          document.getElementById('displayAmount').textContent = '0.00';
          document.getElementById('subOption').value = '';
          document.getElementById('otherItemContainer').style.display = 'none';
          document.getElementById('submissionDateContainer').style.display = 'none';
          updateSubOptions();
        }).catch(error => {
          console.error('Error saving donation:', error);
          alert('An error occurred while submitting your donation. Please try again.');
        });
      } catch (error) {
        console.error('Error saving donation:', error);
        alert('An error occurred while submitting your donation. Please try again.');
      }
    }

    window.onload = function() {
      // Add real-time validation listeners
      const fields = ['fullName', 'email', 'address', 'panNo', 'donationType', 'subOption'];
      fields.forEach(id => {
        const field = document.getElementById(id);
        if (field) {
          field.addEventListener('input', () => validateField(field, getValidationFn(id), getErrorMessage(id)));
        }
      });

      document.addEventListener('change', (e) => {
        if (e.target.id === 'submissionType') {
          validateField(e.target, value => value !== '', 'Please select a submission type.');
        }
      });
    };

    function getValidationFn(id) {
      switch (id) {
        case 'fullName': return value => /^[a-zA-Z\s]{2,}$/.test(value);
        case 'email': return value => /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(value);
        case 'address': return value => value.length >= 5;
        case 'panNo': return value => /^[A-Z]{5}[0-9]{4}[A-Z]$/.test(value);
        case 'donationType': return value => value !== '';
        case 'subOption': return value => value !== '';
        default: return () => true;
      }
    }

    function getErrorMessage(id) {
      switch (id) {
        case 'fullName': return 'Full name must be at least 2 characters long and contain only letters and spaces.';
        case 'email': return 'Please enter a valid email address.';
        case 'address': return 'Address must be at least 5 characters long.';
        case 'panNo': return 'Please enter a valid PAN number (e.g., ABCDE1234F).';
        case 'donationType': return 'Please select a donation type.';
        case 'subOption': return 'Please select a sub-option.';
        default: return '';
      }
    }

    window.addEventListener('message', (event) => {
      if (event.data === 'closePopup') {
        window.parent.closeDonatePopup();
      }
    });
  </script>
</body>
</html>